<!doctype html><html lang="es"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Archivo (prototipo)</title>
<link rel="stylesheet" href="style.css">
</head><body>
<main class="wrap">
  <div class="card">
    <h1>Archivo (prototipo)</h1>
    <div class="actions">
      <a class="btn" href="index.html">← Volver</a>
    </div>
    <div id="list" class="grid2" style="margin-top:16px"></div>
  </div>
</main>

<!-- Supabase + tu conexión -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="state.js"></script>
<script>
// contador y mensajes en página
function showStatus(msg){
  let s = document.getElementById('status');
  if(!s){
    s = document.createElement('p');
    s.id = 'status';
    s.className = 'hint';
    document.querySelector('.card').insertBefore(s, document.getElementById('list'));
  }
  s.textContent = msg;
}

function fmtDate(row){
  const ts = row.created_at || row.inserted_at || row.createdAt || row.date || null;
  if (!ts) return '';
  const d = new Date(ts);
  return isNaN(d) ? '' : d.toLocaleString();
}

async function render(){
  const list = document.getElementById('list');
  list.innerHTML = '';

  if (!window.supabase){
    showStatus('⚠️ Supabase no está cargado.');
    return;
  }

  showStatus('Cargando archivo desde Supabase…');

  // LEE SOLO SUPABASE (para descartar localStorage mientras depuramos)
  const { data, error } = await supabase
    .from('archivo')
    .select('*')
    .order('id', { ascending: false }); // orden por id para evitar problemas con created_at

  if (error){
    console.warn('SELECT error:', error);
    showStatus('❌ Error al leer Supabase: ' + (error.message || error));
    return;
  }

  if (!data || !data.length){
    showStatus('(Archivo vacío en Supabase)');
    return;
  }

  showStatus(`✅ ${data.length} entradas en Supabase`);

  data.forEach(e=>{
    // Si tu columna se llama distinto (p. ej. 'videoclip' o 'video_clip'), usa esta línea:
    const urlVideo = e.videoClip ?? e.videoclip ?? e.video_clip ?? null;

    const tile = document.createElement('div');
    tile.className = 'tile';
    tile.innerHTML = `
      <header><strong>${fmtDate(e)}</strong></header>
      <div class="content">
        <p><strong>Objeto cabeza:</strong> ${e.headText ?? '—'}</p>
        <div class="grid2" style="gap:12px">
          <div>${e.headImg ? `<img src="${e.headImg}" alt="" style="max-width:100%;border-radius:10px">` : ''}</div>
          <div>${urlVideo ? `<video controls src="${urlVideo}" style="width:100%;border-radius:10px"></video>` : ''}</div>
        </div>
        ${e.ghost ? `<p style="opacity:.75;margin-top:8px"><strong>Gesto oculto:</strong> ${e.ghost}</p>` : ''}
      </div>`;
    list.appendChild(tile);
  });
}

render();
</script>
</body></html>
